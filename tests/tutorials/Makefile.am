# Give here the list of existing tests

#SUBDIRS = Xabs/pawpatchgen  Xabs/scfpotgen   Xabs/spectra    

#Flags for optimization libraries
if USE_DGEMMSY
libs_dgemmsy = $(top_builddir)/src/dgemmsy/libdgemmsy.a
else
libs_dgemmsy =
endif
if USE_CUDA_GPU
libs_cuda=$(top_builddir)/src/CUDA/libGPU.a
else
libs_cuda=
endif
if USE_OCL
libs_ocl = $(top_builddir)/src/OpenCL/libOCL.a -lstdc++
else
libs_ocl =
endif
libs_opt=$(libs_cuda) $(libs_ocl) $(libs_dgemmsy)

TESTDIRS = CH4 \
	  CH3- \
	  H2O-slab \
	  N2 \
	  H2O-bader \
	  scalability \
	  dev

EXTRA_DIST = $(TESTDIRS) \
     Figures \
     H1A-Basics.html \
     H1B-Basic_surfaces.html \
     H1C-Basic_post_processing.html \
     H2A-GPU.html \
     H2B-scalability.html \
     H2C-BART.html \
     H2D-splined_saddle.html \
     H2E-minima_hopping.html \
     H2E1-troubleshooting_minima_hopping.html \
     H3B-charge_analysis.html \
     H3C-Wannier.html \
     H3D-Xabs.html \
     H3X-hacking_bigdft.html \
     Mg7-minhop \
     minhop.pdf \
     bart.pdf \
     GPU \
     C2H6 \
     Mg5 \
     Li6 \
     Xabs \
     Wannier

H2O-bader.post-in :
	cp -f input-all.dft input.dft

# Additional rules for the dev tutorial.
dev.check: dev/toy_model
dev/toy_model: $(srcdir)/dev/toy_model.f90
	$(FC) -o $@ $(FCFLAGS) $(AM_FCFLAGS) $(srcdir)/dev/toy_model.f90 -L$(top_builddir)/src -lbigdft  -L$(top_builddir)/src/PSolver -lpoissonsolver $(libs_opt) $(LDFLAGS) $(LIBS)
toy_model.dat.out: dev-N2.out.out toy_model
	./toy_model > toy_model.dat.out
dev.post-clean:
	rm -f toy_model

# Define the precision for specific directories.
%.report: %.ref
	@case $< in \
          *.memguess.ref | *.out.ref) mode="--mode=bigdft";; \
          *) mode="";; \
        esac ; \
        case $* in \
          CH3-.out*) prec="5.e-7" ;; \
          scalability.out*)  prec="1.e-9" ;; \
          *) prec="1.1e-10" ;; \
        esac ; \
	python $(abs_top_srcdir)/tests/fldiff.py $$mode --discrepancy=$$prec $*".out" $< | tee $@

include $(srcdir)/../check.mk
